generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRE_DATABASE_URL")
}

model User {
  id           String      @id @default(uuid())
  username     String      @unique @db.VarChar(100)
  password     String      @db.VarChar(100)
  email        String      @unique @db.VarChar(100)
  nama_lengkap String      @db.VarChar(100)
  aktif        Boolean     @default(true)
  UserGroup    UserGroup[]
  wali         Wali[]
}

model Group {
  id         Int         @id @default(autoincrement())
  nama_group String      @unique @db.VarChar(100)
  deskripsi  String
  UserGroup  UserGroup[]
}

model UserGroup {
  id       Int    @id @default(autoincrement())
  user_id  String
  group_id Int
  group    Group  @relation(fields: [group_id], references: [id])
  user     User   @relation(fields: [user_id], references: [id])
}

model Santri {
  id           Int          @id @default(autoincrement())
  nama_lengkap String       @db.VarChar(100)
  alamat       String       @db.VarChar(255)
  email        String       @db.VarChar(100)
  hp           String?      @db.VarChar(25)
  tempat_lahir String       @db.VarChar(100)
  tgl_lhr      DateTime     @db.Date
  foto         String?      @db.VarChar(100)
  WaliSantri   WaliSantri[]
}

model WaliSantri {
  id        Int       @id @default(autoincrement())
  santri_id Int
  wali_id   Int
  peran     PeranWali
  santri    Santri    @relation(fields: [santri_id], references: [id])
  wali      Wali      @relation(fields: [wali_id], references: [id])
}

model Wali {
  id         Int          @id @default(autoincrement())
  nama_wali  String
  tgl_lhr    DateTime     @db.Date
  email      String?      @unique @db.VarChar(100)
  hp         String?
  user_id    String?
  user       User?        @relation(fields: [user_id], references: [id])
  WaliSantri WaliSantri[]

  @@unique([nama_wali, tgl_lhr], name: "waliIdentifier")
}

enum PeranWali {
  AYAH
  IBU
  WALI
  lainnya
}
